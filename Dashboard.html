<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Connunity Dashboard - Demo (Full)</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, Arial; background:#f3f4f6; color:#111827; }
    .container { max-width:1100px; margin:24px auto; padding:16px; display:grid; grid-template-columns:1fr 320px; gap:20px; }

    header { grid-column:1/-1; display:flex; align-items:center; gap:16px; padding:18px; border-radius:10px;
             background:linear-gradient(90deg,#7c3aed,#ec4899); color:white; }
    .logo { font-weight:700; font-size:22px; letter-spacing:0.3px; }
    .logo-img {
      height: 42px;
      width: auto;
      vertical-align: middle;
      display: inline-block;
    }
    .logo-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-text {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.5px;
      font-family: inherit;
      color: white;
     
      user-select: none;
    }
    .search { flex:1; }
    .search input { width:100%; padding:10px 14px; border-radius:999px; border:0; outline:0; font-size:14px; }
    .btn { background:#1e3a8a; color:white; padding:9px 12px; border-radius:8px; border:0; cursor:pointer; }
    .icon-btn { background:rgba(255,255,255,0.2); color:white; border-radius:8px; padding:8px; border:0; cursor:pointer; }

    .card { background:white; padding:14px; border-radius:10px; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    .mood-row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .mood-pill { padding:6px 10px; border-radius:999px; background:#fff; border:1px solid #e6e6e6; cursor:pointer; font-size:13px; }

    .poll-option {
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px;
      margin-bottom:10px;
      background:#fafafa;
      border:1px solid #e5e7eb;
      border-radius:12px;
      cursor:pointer;
    }
    .poll-create-option {
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px;
      margin-bottom:10px;
      background:#fafafa;
      border:1px solid #e5e7eb;
      border-radius:12px;
    }
    .poll-create-option input[type="radio"] {
      width:14px;
      height:14px;
    }
    .poll-create-option input[type="text"] {
      flex:1;
      padding:8px;
      border:none;
      background:transparent;
      font-size:15px;
      outline:none;
    }

    .posts { margin-top:14px; display:flex; flex-direction:column; gap:16px; }
    .post { border-radius:10px; padding:12px; background:white; border:1px solid #eef2ff; }
    .post .meta { display:flex; gap:10px; align-items:center; font-size:13px; color:#6b7280; margin-bottom:8px; }
    .post .title { font-weight:600; margin-bottom:6px; font-size:16px; }
    .post .body { margin-bottom:10px; color:#374151; }
    .post .actions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; font-size:13px; }
    .action-btn { padding:6px 10px; border-radius:8px; border:1px solid #e6e6e6; background:#fff; cursor:pointer; }

    .right-col { display:flex; flex-direction:column; gap:12px; }
    .community-list { display:flex; flex-direction:column; gap:8px; }
    .community-item { display:flex; justify-content:space-between; align-items:center; padding:8px; border-radius:8px; background:#fff; border:1px solid #e6e6e6; }
    .challenges .challenge { background:#fff; padding:10px; border-radius:8px; }
    .progress { height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; }
    .progress > i { display:block; height:100%; background:#1e3a8a; width:0%; }

    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:flex; align-items:center; justify-content:center; z-index:60; }
    .modal { width:640px; max-width:94%; background:white; border-radius:12px; padding:16px; box-shadow:0 10px 40px rgba(2,6,23,0.4); }
    .comments { margin-top:10px; border-top:1px dashed #e6e6e6; padding-top:8px; }
    .comment { font-size:13px; margin-top:6px; display:flex; gap:8px; align-items:flex-start; }

    @media (max-width:980px) {
      .container { grid-template-columns:1fr; padding:10px; }
      header { flex-direction:column; align-items:flex-start; gap:12px; }
    }

    .muted { color:#6b7280; font-size:13px; }
    .pill { padding:4px 8px; border-radius:999px; background:#eef2ff; color:#1e3a8a; font-weight:600; font-size:12px; }

    /* small layout niceties */
    .top-actions { display:flex; gap:8px; align-items:center; }
    .avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 700;
      font-size: 14px;
      line-height: 1;
      background: linear-gradient(90deg, #4c1d95 0%, #be185d 100%); /* darker gradient for better contrast */
      background-color: #4c1d95; /* fallback */
      box-shadow: 0 1px 2px rgba(0,0,0,0.12);
      user-select: none;
    }
    .muted-small { color:#6b7280; font-size:12px; }
    .small { font-size:13px; }

    /* drag & drop file area */
    .dropzone {
      border: 2px dashed rgba(99,102,241,0.25);
      border-radius: 8px;
      padding: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:64px;
      background: #ffffff;
      cursor: pointer;
    }
    .dropzone.dragover {
      border-color: #7c3aed;
      background: #fbf7ff;
    }
    .file-input-hidden { display:none; }
    .preview-img, .preview-video { max-width:100%; border-radius:8px; display:block; }
    .preview-video { max-height:320px; }

    /* Constrain post images and videos */
    .post img, .post video {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      display: block;
      object-fit: contain;
    }
    #filePreview { display:block; }
  </style>
</head>
<body>

  <header>
    <div class="logo-wrapper">
      <img src="Logo.jpeg" class="logo-img" alt="Conn-unity Logo" />
      <span class="logo-text">Conn-unity</span>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="Search Conn-unity (posts, communities...)" />
    </div>

    <div style="display:flex;gap:8px;align-items:center" class="top-actions">
      <button id="createBtn" class="btn">Create Post</button>
      <button id="createCommunityBtn" class="action-btn">Create Community</button>
      <button id="notifBtn" class="icon-btn">üîî <span id="notifBadge" style="display:inline-block;margin-left:6px;background:#ef4444;color:white;padding:2px 6px;border-radius:10px;font-size:12px;vertical-align:middle;"></span></button>

      <div id="authArea">
        <!-- Filled by JS: login / user -->
      </div>
    </div>
  </header>

  <main class="container">
    <section>
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div style="font-weight:700">What's your mood?</div>
          <div class="muted">Quick filter</div>
        </div>
        <div class="mood-row" id="moodRow"></div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div style="font-weight:700;margin-bottom:8px">Community Poll</div>
        <div id="pollQuestion" class="muted"></div>
        <div id="pollOptions" style="margin-top:10px;"></div>
        <div style="margin-top:10px;">
          <button id="submitPoll" class="btn">Submit vote</button>
          <button id="viewPollResults" class="action-btn">View results</button>
        </div>
      </div>

      <div class="posts" id="postsContainer"></div>
    </section>

    <aside class="right-col">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Your profile</div>
          <div class="pill" id="profileRole">Visitor</div>
        </div>
        <div class="muted" style="margin-top:8px">Your personal page. Create posts and join communities.</div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="createPostBtn" class="btn">Create Post</button>
          <button id="viewMySaved" class="action-btn">Saved</button>
        </div>
      </div>

      <div class="card">
        <div style="font-weight:700;margin-bottom:8px">Popularity Community</div>
        <div class="community-list" id="communityList"></div>
        <div style="margin-top:8px;text-align:center"><button id="viewAllCommunities" class="action-btn">View All Community</button></div>
      </div>

      <div class="card challenges">
        <div style="font-weight:700;margin-bottom:8px">Daily Challenges</div>
        <div id="challengesList"></div>
      </div>

      <div class="card">
        <div style="font-weight:700;margin-bottom:8px">About Community</div>
        <div class="muted">A friendly place to share ideas, discover new communities and meet creators.</div>
      </div>
    </aside>
  </main>

  <!-- Create Post Modal -->
  <div id="postModal" style="display:none;">
    <div class="modal-backdrop" id="postBackdrop">
      <div class="modal card">
        <h3>Create Post</h3>
        <div id="createPostTabs" style="display:flex; gap:16px; margin-top:12px; border-bottom:1px solid #e6e6e6; padding-bottom:8px;">
          <button class="action-btn" data-tab="textTab" style="border:none; background:none; font-weight:600;">Text</button>
          <button class="action-btn" data-tab="mediaTab" style="border:none; background:none;">Images & Video</button>
          <button class="action-btn" data-tab="linkTab" style="border:none; background:none;">Link</button>
          <button class="action-btn" data-tab="pollTab" style="border:none; background:none;">Poll</button>
        </div>

        <div id="textTab" class="postTabSection">
          <input id="postTitle" placeholder="Title" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;margin:12px 0;" />
          <textarea id="postBody" rows="5" placeholder="Body text (optional)"
            style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;"></textarea>
        </div>

        <div id="mediaTab" class="postTabSection" style="display:none; margin-top:12px;">
          <div style="font-weight:600;margin-bottom:6px;">Upload Images or Video</div>
          <div id="dropzone" class="dropzone">
            <div id="dropzoneText">Drag & drop media ‚Äî or</div>
            <button id="chooseFileBtn" type="button" class="action-btn" style="margin-left:8px;">Choose File</button>
            <input id="postFileInput" type="file" accept="*/*" class="file-input-hidden" />
          </div>
          <div id="filePreview" style="margin-top:10px;"></div>
        </div>

        <div id="linkTab" class="postTabSection" style="display:none; margin-top:12px;">
          <input id="postLink" placeholder="Paste a URL"
            style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;" />
        </div>

        <div id="pollTab" class="postTabSection" style="display:none; margin-top:12px;">
          <input id="pollQuestionInput" placeholder="Poll question"
                 style="width:100%;padding:12px;border-radius:10px;border:1px solid #e5e7eb;font-size:15px;margin-bottom:14px;" />

          <div id="pollCreateContainer"></div>

          <button id="addPollOption" class="action-btn" style="margin-top:8px;width:100%;border-radius:10px;">Add Option</button>
        </div>

        <div style="margin-top:8px;">
          <select id="postCommunity" style="padding:8px;border-radius:8px;border:1px solid #e6e6e6;"></select>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button id="modalCancel" class="action-btn">Cancel</button>
          <button id="modalCreate" class="btn">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Community Modal -->
  <div id="communityModal" style="display:none;">
    <div class="modal-backdrop" id="communityBackdrop">
      <div class="modal card">
        <h3>Create Community</h3>
        <div style="margin-top:8px;">
          <input id="communityName" placeholder="Community name (no spaces, e.g. gardening)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;" />
          <textarea id="communityDesc" rows="3" placeholder="Short description (optional)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;"></textarea>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button id="communityCancel" class="action-btn">Cancel</button>
          <button id="communityCreate" class="btn">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" style="display:none;">
    <div class="modal-backdrop" id="loginBackdrop">
      <div class="modal card">
        <h3>Login / Signup</h3>
        <div style="margin-top:8px;">
          <input id="loginName" placeholder="Display name" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;" />
          <input id="loginEmail" placeholder="Email (used as id)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:8px;" />
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
          <button id="loginCancel" class="action-btn">Cancel</button>
          <button id="loginSubmit" class="btn">Login</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications dropdown -->
  <div id="notifDropdown" style="display:none;position:fixed;right:24px;top:80px;width:320px;background:white;border-radius:8px;padding:12px;box-shadow:0 6px 24px rgba(0,0,0,0.12);z-index:50;">
    <div style="font-weight:700;margin-bottom:8px">Notifications <button id="clearNotifs" style="float:right" class="action-btn">Clear</button></div>
    <div id="notifList" style="max-height:280px;overflow:auto"></div>
  </div>

  <script>
    // Static demo data (no persistence)
    const state = {
      users: [
        { id:'guest', name:'Guest', email:'', avatarLetter:'G' }
      ],
      communities: [
        { id:'c1', name:'technology', members:2500, joined: true, desc:'Tech talk' },
        { id:'c2', name:'gaming', members:1800, joined: false, desc:'Games & streams' },
        { id:'c3', name:'cooking', members:840, joined: false, desc:'Recipes & tips' },
      ],
      moods: ['Inspiring','Funny','Educational','Wholesome','Creative','Chill'],
      posts: [
        { id:'p1', community:'technology', author:'techEnthusiast42', authorId:null, title:'The Future of AI in Software Development', body:'AI tools are reshaping how we write code. What do you think?', image:'', likes:3500, dislikes:20, comments:[{id:'cm1',author:'user2',text:'Great read!'}], savedBy:[], createdAt: Date.now()-3600*1000*10 },
        { id:'p2', community:'gaming', author:'PixelWarrior', authorId:null, title:'Hidden Gem Indie Game', body:'Just finished this indie game ‚Äî highly recommend!', image:'', likes:16500, dislikes:120, comments:[], savedBy:[], createdAt: Date.now()-3600*1000*24 }
      ],
      dailyChallenges: [
        { id:'d1', title:'Community Contributor', progress:20, goal:100 },
        { id:'d2', title:'Conversation Starter', progress:50, goal:100 },
        { id:'d3', title:'Post 5 Comment', progress:0, goal:5 }
      ],
      polls: [
        { id:'poll1', question:'What feature should we build next?', options:[ {id:'o1',text:'Dark Mode',votes:24}, {id:'o2',text:'Mobile App',votes:38}, {id:'o3',text:'AI Assistant',votes:15}, {id:'o4',text:'Advanced Search',votes:23} ], votedBy:[] }
      ]
    };
    let filter = { search:'', mood:null };

    // Safe DOM helpers: query and return null-safe element
    function $id(id){ return document.getElementById(id) || null; }

    // Elements (guarded)
    const moodRow = $id('moodRow');
    const postsContainer = $id('postsContainer');
    const communityList = $id('communityList');
    const challengesList = $id('challengesList');
    const searchInput = $id('searchInput');
    const pollQuestion = $id('pollQuestion');
    const pollOptions = $id('pollOptions');

    // Modals & controls (guarded)
    const postModal = $id('postModal');
    const postBackdrop = $id('postBackdrop');
    const createBtn = $id('createBtn');
    const createPostBtn = $id('createPostBtn');
    const postTitle = $id('postTitle');
    const postBody = $id('postBody');
    const postCommunity = $id('postCommunity');
    const postFileInput = $id('postFileInput');
    const dropzone = $id('dropzone');
    const filePreview = $id('filePreview');
    const chooseFileBtn = $id('chooseFileBtn');
    let selectedFileData = ''; // will hold a dataURL for image/video
    const modalCancel = $id('modalCancel');
    const modalCreate = $id('modalCreate');

    // community modal
    const communityModal = $id('communityModal');
    const communityBackdrop = $id('communityBackdrop');
    const createCommunityBtn = $id('createCommunityBtn');
    const communityName = $id('communityName');
    const communityDesc = $id('communityDesc');
    const communityCancel = $id('communityCancel');
    const communityCreate = $id('communityCreate');

    // login modal
    const loginModal = $id('loginModal');
    const loginBackdrop = $id('loginBackdrop');
    const loginName = $id('loginName');
    const loginEmail = $id('loginEmail');
    const loginCancel = $id('loginCancel');
    const loginSubmit = $id('loginSubmit');

    const submitPoll = $id('submitPoll');
    const viewPollResults = $id('viewPollResults');
    const clearNotifs = $id('clearNotifs');

    // Helpers
    function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }
    function escapeHtml(s){ return (s||'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function timeAgo(ts){ if (!ts) return ''; const s=Math.floor((Date.now()-ts)/1000); if (s<60) return s+'s'; if (s<3600) return Math.floor(s/60)+'m'; if (s<3600*24) return Math.floor(s/3600)+'h'; return Math.floor(s/(3600*24))+'d'; }

    // ---------- drag & drop / file select helpers ----------
    function clearPreview(){ selectedFileData = ''; if (filePreview) filePreview.innerHTML = ''; }

    function renderPreview(dataUrl, type){
      clearPreview();
      selectedFileData = dataUrl;
      if (!filePreview) return;
      if (type && type.startsWith('image/')){
        const img = document.createElement('img'); img.src = dataUrl; img.className = 'preview-img'; filePreview.appendChild(img);
      } else if (type && type.startsWith('video/')){
        const vid = document.createElement('video'); vid.src = dataUrl; vid.controls = true; vid.className = 'preview-video'; filePreview.appendChild(vid);
      } else {
        filePreview.innerHTML = '';
        const info = document.createElement('div'); info.style.padding = '8px'; info.style.border = '1px solid #e6e6e6'; info.style.borderRadius = '8px'; info.textContent = 'File ready'; filePreview.appendChild(info);
      }
    }

    function handleFile(file){
      if (!file) return;
      const maxSize = 2 * 1024 * 1024 * 1024; // 2GB
      if (file.size > maxSize){ alert('File too large! Maximum allowed size is 2GB.'); return; }
      const reader = new FileReader();
      reader.onload = (e)=>{
        const data = e.target && e.target.result;
        selectedFileData = data;
        if (file.type && (file.type.startsWith('image/') || file.type.startsWith('video/'))){
          renderPreview(data, file.type);
        } else if (filePreview) {
          filePreview.innerHTML = '';
          const info = document.createElement('div');
          info.style.padding = '8px'; info.style.border = '1px solid #e6e6e6'; info.style.borderRadius = '8px';
          info.textContent = 'File ready: ' + file.name + ' (' + Math.round(file.size/1024) + ' KB)';
          filePreview.appendChild(info);
        }
      };
      reader.readAsDataURL(file);
    }

    // wire events safely
    if (dropzone){
      dropzone.addEventListener('dragover', (e)=>{ e.preventDefault(); dropzone.classList.add('dragover'); });
      dropzone.addEventListener('dragenter', (e)=>{ e.preventDefault(); dropzone.classList.add('dragover'); });
      dropzone.addEventListener('dragleave', (e)=>{ e.preventDefault(); dropzone.classList.remove('dragover'); });
      dropzone.addEventListener('drop', (e)=>{ e.preventDefault(); dropzone.classList.remove('dragover'); const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]; if (f) handleFile(f); });
      dropzone.addEventListener('click', ()=> { if (postFileInput) postFileInput.click(); });
    }
    if (chooseFileBtn) chooseFileBtn.addEventListener('click', ()=> { if (postFileInput) postFileInput.click(); });
    if (postFileInput) postFileInput.addEventListener('change', (e)=>{ const f = e.target.files && e.target.files[0]; if (f) handleFile(f); });

    if (createBtn) createBtn.addEventListener('click', openPostModalIfAvailable);
    if (createPostBtn) createPostBtn.addEventListener('click', openPostModalIfAvailable);
    if (modalCancel) modalCancel.addEventListener('click', () => { if (postModal) postModal.style.display = 'none'; });
    if (postBackdrop) postBackdrop.addEventListener('click', (e)=> { if (e.target === postBackdrop && postModal) postModal.style.display = 'none'; });

    // community modal safe wiring
    if (createCommunityBtn) createCommunityBtn.addEventListener('click', ()=> { if (communityModal) communityModal.style.display = 'block'; });
    if (communityCancel) communityCancel.addEventListener('click', ()=> { if (communityModal) communityModal.style.display = 'none'; });
    if (communityBackdrop) communityBackdrop.addEventListener('click', (e)=> { if (e.target === communityBackdrop && communityModal) communityModal.style.display = 'none'; });

    // login modal safe wiring
    if (loginCancel) loginCancel.addEventListener('click', ()=> { if (loginModal) loginModal.style.display = 'none'; });
    if (loginBackdrop) loginBackdrop.addEventListener('click', (e)=> { if (e.target === loginBackdrop && loginModal) loginModal.style.display = 'none'; });

    // Poll buttons might be disabled in static demo but guard attachments
    if (submitPoll) submitPoll.addEventListener('click', ()=> alert('Polls are disabled in static demo.'));
    if (viewPollResults) viewPollResults.addEventListener('click', ()=> alert('Polls are disabled in static demo.'));
    if (clearNotifs) clearNotifs.addEventListener('click', ()=> { alert('Notifications are disabled in static demo.'); });

    // Helpers
    function safeText(val){ return val == null ? '' : String(val); }

    /* ---------- Render components ---------- */
    function renderMoods(){
      if (!moodRow) return;
      moodRow.innerHTML=''; state.moods.forEach(m=>{
        const b = document.createElement('button'); b.className='mood-pill'; b.textContent=m;
        b.onclick = ()=> { filter.mood = (filter.mood===m? null : m); renderAll(); };
        if (filter.mood===m) b.style.borderColor = '#7c3aed';
        moodRow.appendChild(b);
      });
    }

    function renderCommunities(){
      if (!communityList) return;
      communityList.innerHTML=''; const arr = state.communities.slice().sort((a,b)=> b.members - a.members);
      arr.forEach(c=>{
        const el = document.createElement('div'); el.className='community-item';
        el.innerHTML = `<div><strong>c/${escapeHtml(c.name)}</strong><div class="muted-small">${(c.members||0).toLocaleString()} members</div></div>`;
        const btn = document.createElement('button'); btn.className='action-btn'; btn.textContent = (c.joined ? 'Joined' : 'Join'); btn.disabled = true;
        el.appendChild(btn); communityList.appendChild(el);
      });
    }

    function renderChallenges(){
      if (!challengesList) return;
      challengesList.innerHTML=''; state.dailyChallenges.forEach(d=>{
        const div = document.createElement('div'); div.className='challenge';
        const percent = Math.min(100, Math.round(((d.progress||0) / (d.goal||1))*100));
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div><strong>${escapeHtml(d.title)}</strong></div>
            <div class="muted-small">${d.progress}/${d.goal}</div>
          </div>
          <div class="progress" style="margin-top:8px">
            <i style="width:${percent}%"></i>
          </div>
          <div style="margin-top:8px; display:flex; gap:8px;">
            <button class="action-btn" disabled>Complete</button>
            <button class="action-btn" disabled>Claim Reward</button>
          </div>
        `;
        challengesList.appendChild(div);
      });
    }

    function renderPoll(){
      if (!pollQuestion || !pollOptions) return;
      const poll = state.polls && state.polls[0]; if (!poll) return;
      pollQuestion.textContent = poll.question || '';
      pollOptions.innerHTML = '';
      (poll.options||[]).forEach(opt=>{
        const label = document.createElement('label'); label.className='poll-option';
        label.innerHTML = `<input type="radio" name="pollChoice" value="${opt.id}" style="margin-right:8px" disabled/> ${escapeHtml(opt.text)}`;
        pollOptions.appendChild(label);
      });
      if (submitPoll) submitPoll.disabled = true; if (viewPollResults) viewPollResults.disabled = true;
    }

    function renderPosts(){
      if (!postsContainer) return;
      postsContainer.innerHTML = '';
      const q = (filter.search||'').toLowerCase();
      const mood = filter.mood;
      let posts = (state.posts||[]).slice().filter(p=>{
        if (q) {
          const title = safeText(p.title).toLowerCase(); const body = safeText(p.body).toLowerCase(); const community = safeText(p.community).toLowerCase();
          if (!(title.includes(q) || body.includes(q) || community.includes(q))) return false;
        }
        if (mood) {
          if (!(safeText(p.title).toLowerCase().includes(mood.toLowerCase()) || safeText(p.body).toLowerCase().includes(mood.toLowerCase()))) return false;
        }
        return true;
      }).sort((a,b)=> (b.createdAt||0) - (a.createdAt||0));

      posts.forEach(p=>{
        const el = document.createElement('div'); el.className='post card';
        // ensure safe fields
        const likes = p.likes || 0; const dislikes = p.dislikes || 0; const comments = p.comments || [];
        const contentHtml = (function(){
          try{
            if (p.type === 'media' && p.content){
              if (String(p.content).startsWith('data:video')) return `<div style="margin:8px 0"><video src="${escapeHtml(p.content)}" controls class="preview-video"></video></div>`;
              return `<div style="margin:8px 0"><img src="${escapeHtml(p.content)}" class="preview-img"/></div>`;
            } else if (p.type === 'link' && p.content){
              return `<div style="margin:8px 0"><a href="${escapeHtml(p.content)}" target="_blank" style="color:#1e3a8a;font-weight:600">${escapeHtml(p.content)}</a></div>`;
            } else if (p.type === 'poll' && p.content){
              return `<div style="margin:8px 0"><div style="font-weight:600">üìä ${escapeHtml(p.content.question)}</div><ul style="margin-top:6px;">${(p.content.options||[]).map(o=>`<li style="padding:4px 0;">‚Ä¢ ${escapeHtml(o)}</li>`).join('')}</ul></div>`;
            }
            return '';
          }catch(e){ return ''; }
        })();

        el.innerHTML = `
          <div class="meta">
            <div class="pill">c/${escapeHtml(p.community)}</div>
            <div>${escapeHtml(p.author)}</div>
            <div class="muted">${timeAgo(p.createdAt)}</div>
          </div>
          <div class="title">${escapeHtml(p.title)}</div>
          <div class="body">${escapeHtml(p.body)}</div>
          ${contentHtml}
          <div class="actions">
            <button class="action-btn" disabled>üëç <span class="count">${likes}</span></button>
            <button class="action-btn" disabled>üëé <span class="count">${dislikes}</span></button>
            <button class="action-btn" disabled>Share</button>
            <button class="action-btn" disabled>Save</button>
            <button class="action-btn comment-toggle">Comment (${comments.length})</button>
          </div>
          <div class="comments" style="display:none"></div>
        `;

        const commentToggle = el.querySelector('.comment-toggle');
        const commentsEl = el.querySelector('.comments');
        if (commentToggle && commentsEl) {
          commentToggle.onclick = ()=> {
            if (commentsEl.style.display === 'none' || commentsEl.style.display === '') {
              commentsEl.style.display = 'block'; renderComments(p, commentsEl);
            } else { commentsEl.style.display = 'none'; }
          };
        }
        postsContainer.appendChild(el);
      });

      if (posts.length===0) postsContainer.innerHTML = '<div class="card muted">No posts found.</div>';
    }

    function renderComments(post, container){
      if (!container) return; container.innerHTML = '';
      (post.comments||[]).forEach(c=>{
        const cdiv = document.createElement('div'); cdiv.className='comment';
        cdiv.innerHTML = `<div style="width:36px;height:36px;border-radius:50%;background:#ddd;display:flex;align-items:center;justify-content:center">${escapeHtml((c.author||'U').split(' ').map(x=>x[0]).slice(0,2).join(''))}</div><div><strong style="font-size:13px">${escapeHtml(c.author)}</strong><div style="font-size:13px;color:#374151">${escapeHtml(c.text)}</div></div>`;
        container.appendChild(cdiv);
      });
    }

    // Poll create container
    const pollCreateContainer = $id('pollCreateContainer');
    function addPollCreateOption(text = ''){
      if (!pollCreateContainer) return;
      const div = document.createElement('div'); div.className = 'poll-create-option';
      div.innerHTML = `<input type="radio" disabled /><input type="text" class="pollOptInput" placeholder="Option text" value="${escapeHtml(text)}">`;
      pollCreateContainer.appendChild(div);
    }

    // default poll options
    addPollCreateOption(); addPollCreateOption();
    const addPollOptionBtn = $id('addPollOption'); if (addPollOptionBtn) addPollOptionBtn.onclick = () => addPollCreateOption();

    // ---------- Create Post Modal (UI only, no backend) ----------
    function openPostModalIfAvailable(){
      if (!postModal) return; // nothing to do if modal not present
      // reset fields
      if (postTitle) postTitle.value = '';
      if (postBody) postBody.value = '';
      const postLinkEl = $id('postLink'); if (postLinkEl) postLinkEl.value = '';
      const pollQuestionInput = $id('pollQuestionInput'); if (pollQuestionInput) pollQuestionInput.value = '';
      if (pollCreateContainer) pollCreateContainer.innerHTML = '';
      addPollCreateOption(); addPollCreateOption();
      selectedFileData = ''; if (filePreview) filePreview.innerHTML = '';
      if (postCommunity) { postCommunity.innerHTML = ''; state.communities.forEach(c => { const op = document.createElement('option'); op.value = c.name; op.textContent = 'c/' + c.name; postCommunity.appendChild(op); }); }
      // Show default tab (Text)
      document.querySelectorAll('.postTabSection').forEach(tab => tab.style.display = 'none');
      const textTab = $id('textTab'); if (textTab) textTab.style.display = 'block';
      // Tab buttons logic
      document.querySelectorAll('#createPostTabs button').forEach(btn => { btn.onclick = () => { document.querySelectorAll('.postTabSection').forEach(tab => tab.style.display = 'none'); const target = $id(btn.dataset.tab); if (target) target.style.display = 'block'; }; });
      postModal.style.display = 'block';
    }

    function closePostModal(){ if (postModal) postModal.style.display='none'; }
    if (modalCreate) modalCreate.addEventListener('click', ()=>{ alert('This is a static demo. Post creation is not available.'); closePostModal(); selectedFileData = ''; });

    /* ---------- Search ---------- */
    if (searchInput) searchInput.oninput = (e)=> { filter.search = e.target.value || ''; renderAll(); };

    /* ---------- utils & initial ---------- */
    function getInitials(name){ return (name||'U').split(' ').map(x=>x[0]).slice(0,2).join(''); }

    function renderAll(){ renderMoods(); renderCommunities(); renderChallenges(); renderPoll(); renderPosts(); }

    // start
    try{ renderAll(); }catch(e){ console.error('Render failed', e); }
  </script>
</body>
</html>
   